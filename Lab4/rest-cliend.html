<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST Client</title>
</head>
<body>
    <h3>RESTful Web API</h3>
    <hr>
    <button onclick="doGetAll()">Get All</button>
    <button onclick="doGetByKey()">Get By Key</button>
    <button onclick="doPost()">Post</button>
    <button onclick="doPut()">Put</button>
    <button onclick="doDelete()">Delete</button>
    
    <div class="console-output">
        <h4>Console Output:</h4>
        <pre id="output"></pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const host = "https://lab4java5ts00680-default-rtdb.asia-southeast1.firebasedatabase.app";
        let currentKey = null;

        function log(message, data) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n${JSON.stringify(data, null, 2)}\n\n`;
            console.log(message, data);
        }

        function doGetAll() {
            var url = `${host}/students.json`;
            axios.get(url).then(resp => {
                log("Success - Get All Students:", resp.data);
                if (resp.data && Object.keys(resp.data).length > 0) {
                    currentKey = Object.keys(resp.data)[0];
                    log("First key saved for testing:", currentKey);
                }
            }).catch(error => {
                log("Error:", error);
            });
        }

        function doGetByKey() {
            var key = prompt("Enter student key:", currentKey || "");
            if (!key) {
                alert("Please provide a key!");
                return;
            }
            var url = `${host}/students/${key}.json`;
            axios.get(url).then(resp => {
                log(`Success - Get Student by Key (${key}):`, resp.data);
            }).catch(error => {
                log("Error:", error);
            });
        }

        function doPost() {
            var url = `${host}/students.json`;
            var data = {
                "id": "SV99",
                "name": "Sinh viên 99",
                "mark": 4.5,
                "gender": true
            };
            axios.post(url, data).then(resp => {
                log("Success - Post New Student:", resp.data);
                currentKey = resp.data.name;
                alert(`Student created with key: ${currentKey}`);
            }).catch(error => {
                log("Error:", error);
            });
        }

        function doPut() {
            var key = prompt("Enter student key to update:", currentKey || "");
            if (!key) {
                alert("Please provide a key!");
                return;
            }
            var url = `${host}/students/${key}.json`;
            var data = {
                "id": "SV00",
                "name": "Sinh viên 00",
                "mark": 8.5,
                "gender": true
            };
            axios.put(url, data).then(resp => {
                log(`Success - Update Student (${key}):`, resp.data);
            }).catch(error => {
                log("Error:", error);
            });
        }

        function doDelete() {
            var key = prompt("Enter student key to delete:", currentKey || "");
            if (!key) {
                alert("Please provide a key!");
                return;
            }
            if (!confirm(`Are you sure you want to delete student with key: ${key}?`)) {
                return;
            }
            var url = `${host}/students/${key}.json`;
            axios.delete(url).then(resp => {
                log(`Success - Delete Student (${key}):`, resp.data);
                currentKey = null;
            }).catch(error => {
                log("Error:", error);
            });
        }
    </script>
</body>
</html>